<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personalización de Bicicletas - MasterBikes</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/navbar.css">
    <style>
        .fade-in {
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .bike-card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .bike-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .component-selector {
            border-left: 4px solid #0d6efd;
            padding-left: 15px;
            margin-bottom: 20px;
        }
        
        .cart-item {
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1060;
        }
    </style>
</head>
<body>
<header>
    <object
            type="text/html"
            data="../components/topbar.html"
            style="width:100%; height:100px; border:none; overflow:hidden;">
    </object>
</header>

    <!-- Main Content -->
    <div class="container my-5">
        <h1 class="mb-4">Personaliza tu Bicicleta o Arrienda una</h1>
        <p class="lead mb-5">Selecciona un modelo base para personalizar o elige una bicicleta de arriendo.</p>
        
        <!-- Sección de selección de bicicletas -->
        <div id="bikesSection">
            <h2 class="mb-4">Selecciona un modelo para personalizar</h2>
            <div class="row row-cols-1 row-cols-md-3 g-4">
                <!-- Bicicletas para personalizar -->
                <div class="col">
                    <div class="card h-100 bike-card">
                        <img src="img/bikes/bike1.jpg" class="card-img-top" alt="Trek Marlin 5">
                        <div class="card-body">
                            <h5 class="card-title">Trek Marlin 5</h5>
                            <p class="card-text">Mountain bike de alto rendimiento para terrenos difíciles.</p>
                            <p class="card-text fw-bold">$699.990</p>
                            <button class="btn btn-primary customize-btn" 
                                data-bike-id="1" 
                                data-bike-name="Marlin 5" 
                                data-bike-brand="Trek" 
                                data-bike-price="699990" 
                                data-bike-image="img/bikes/bike1.jpg">
                                Personalizar
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col">
                    <div class="card h-100 bike-card">
                        <img src="img/bikes/bike2.jpg" class="card-img-top" alt="Specialized Allez">
                        <div class="card-body">
                            <h5 class="card-title">Specialized Allez</h5>
                            <p class="card-text">Bicicleta de ruta ligera y aerodinámica para largas distancias.</p>
                            <p class="card-text fw-bold">$899.990</p>
                            <button class="btn btn-primary customize-btn" 
                                data-bike-id="2" 
                                data-bike-name="Allez" 
                                data-bike-brand="Specialized" 
                                data-bike-price="899990" 
                                data-bike-image="img/bikes/bike2.jpg">
                                Personalizar
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col">
                    <div class="card h-100 bike-card">
                        <img src="img/bikes/bike3.jpg" class="card-img-top" alt="Giant Escape 2">
                        <div class="card-body">
                            <h5 class="card-title">Giant Escape 2</h5>
                            <p class="card-text">Bicicleta urbana versátil para desplazamientos diarios.</p>
                            <p class="card-text fw-bold">$549.990</p>
                            <button class="btn btn-primary customize-btn" 
                                data-bike-id="3" 
                                data-bike-name="Escape 2" 
                                data-bike-brand="Giant" 
                                data-bike-price="549990" 
                                data-bike-image="img/bikes/bike3.jpg">
                                Personalizar
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card h-100 bike-card">
                        <img src="img/bikes/bike4.jpg" class="card-img-top" alt="Cannondale CAAD Optimo Claris">
                        <div class="card-body">
                            <h5 class="card-title">Cannondale CAAD Optimo Claris</h5>
                            <p class="card-text">Bicicleta de ruta de aluminio con gran relación calidad-precio.</p>
                            <p class="card-text fw-bold">$799.990</p>
                            <button class="btn btn-primary customize-btn" 
                                data-bike-id="4" 
                                data-bike-name="CAAD Optimo Claris" 
                                data-bike-brand="Cannondale" 
                                data-bike-price="799990" 
                                data-bike-image="img/bikes/bike4.jpg">
                                Personalizar
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card h-100 bike-card">
                        <img src="img/bikes/bike5.jpg" class="card-img-top" alt="Scott Aspect 960">
                        <div class="card-body">
                            <h5 class="card-title">Scott Aspect 960</h5>
                            <p class="card-text">Mountain bike versátil para principiantes y entusiastas.</p>
                            <p class="card-text fw-bold">$599.990</p>
                            <button class="btn btn-primary customize-btn" 
                                data-bike-id="5" 
                                data-bike-name="Aspect 960" 
                                data-bike-brand="Scott" 
                                data-bike-price="599990" 
                                data-bike-image="img/bikes/bike5.jpg">
                                Personalizar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sección de configurador (inicialmente oculta) -->
        <div id="configurador" style="display: none;">
            <div class="row">
                <!-- Vista previa de la bicicleta -->
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <img id="bikePreview" src="" class="card-img-top" alt="Vista previa de la bicicleta">
                        <div class="card-body">
                            <h5 class="card-title">Vista previa</h5>
                            <p class="card-text">Esta es una representación de tu bicicleta personalizada.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Opciones de personalización -->
                <div class="col-md-6">
                    <h3 class="mb-4">Personaliza tu bicicleta</h3>
                    
                    <!-- Selector de cuadro -->
                    <div class="component-selector">
                        <h5>Cuadro</h5>
                        <select class="form-select builder-select" data-part="frame">
                            <option value="">Selecciona un cuadro</option>
                            <option value="frame-1">Trek Alpha Gold (+$150.000)</option>
                            <option value="frame-2">Specialized Allez (+$180.000)</option>
                            <option value="frame-3">Giant ALUXX (+$120.000)</option>
                        </select>
                    </div>
                    
                    <!-- Selector de ruedas -->
                    <div class="component-selector">
                        <h5>Ruedas</h5>
                        <select class="form-select builder-select" data-part="wheel">
                            <option value="">Selecciona ruedas</option>
                            <option value="wheel-4">Mavic Crossmax (+$90.000)</option>
                            <option value="wheel-5">DT Swiss X1900 (+$120.000)</option>
                            <option value="wheel-6">Shimano MT500 (+$75.000)</option>
                        </select>
                    </div>
                    
                    <!-- Selector de transmisión -->
                    <div class="component-selector">
                        <h5>Transmisión</h5>
                        <select class="form-select builder-select" data-part="drivetrain">
                            <option value="">Selecciona transmisión</option>
                            <option value="drivetrain-7">Shimano Deore (+$85.000)</option>
                            <option value="drivetrain-8">SRAM NX Eagle (+$110.000)</option>
                            <option value="drivetrain-9">Shimano XT (+$130.000)</option>
                        </select>
                    </div>
                    
                    <!-- Selector de frenos -->
                    <div class="component-selector">
                        <h5>Frenos</h5>
                        <select class="form-select builder-select" data-part="brakes">
                            <option value="">Selecciona frenos</option>
                            <option value="brakes-10">Shimano MT200 (+$45.000)</option>
                            <option value="brakes-11">SRAM Level T (+$65.000)</option>
                            <option value="brakes-12">Magura MT5 (+$95.000)</option>
                        </select>
                    </div>
                    
                    <!-- Botón de añadir al carrito -->
                    <button id="addToCart" class="btn btn-success btn-lg w-100 mt-4">
                        <i class="bi bi-cart-plus me-2"></i>Añadir al carrito
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Offcanvas del carrito -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="cartOffcanvas" aria-labelledby="cartOffcanvasLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="cartOffcanvasLabel">Carrito de compras</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div id="cartItems">
                <!-- Aquí se mostrarán los items del carrito -->
            </div>
            <div class="mt-4">
                <h5>Total: <span id="cartTotal">$0</span></h5>
                <button id="proceedToCheckout" class="btn btn-primary w-100 mt-3">
                    <i class="bi bi-check-outbox me-2"></i>Proceder al pago
                </button>
            </div>
        </div>
    </div>

    <!-- Toast container para notificaciones -->
    <div id="toast-container"></div>

    <footer>
        <object
                id="footerObj"
                type="text/html"
                data="/components/footer.html"
                style="width:100%; border:none; overflow:hidden;"
                onload="
          this.style.height =
            this.contentDocument.documentElement.scrollHeight + 'px';
        ">
        </object>
    </footer>

    <!-- Bootstrap JS y Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    
    <!-- Custom JS -->
    <script>
        // Variables globales
        let selectedBike = null;
        let cart = [];

        // Función para actualizar el contador del carrito
        function updateCartCounter() {
            const counter = document.querySelector('.cart-counter');
            counter.textContent = cart.length;
        }

        // Función para mostrar un toast
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.classList.add('toast', 'show', `bg-${type}`, 'text-white');
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            toast.innerHTML = `
                <div class="toast-body">
                    ${message}
                </div>
            `;
            toastContainer.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Función para actualizar el carrito en el offcanvas
        function updateCartOffcanvas() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            let total = 0;

            cartItems.innerHTML = '';
            cart.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.classList.add('cart-item', 'mb-3');
                itemElement.innerHTML = `
                    <h6>${item.brand} ${item.name}</h6>
                    <p>Precio: ${item.price.toLocaleString()}</p>
                    <button class="btn btn-sm btn-danger remove-from-cart" data-index="${index}">Eliminar</button>
                `;
                cartItems.appendChild(itemElement);
                total += item.price;
            });

            cartTotal.textContent = `${total.toLocaleString()}`;

            // Agregar event listeners a los botones de eliminar
            document.querySelectorAll('.remove-from-cart').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    cart.splice(index, 1);
                    updateCartOffcanvas();
                    updateCartCounter();
                    showToast('Producto eliminado del carrito', 'danger');
                });
            });
        }

        // Event listener para los botones de personalizar y arrendar
        document.querySelectorAll('.customize-btn, .rent-btn').forEach(button => {
            button.addEventListener('click', function() {
                const bikeId = this.getAttribute('data-bike-id');
                const bikeName = this.getAttribute('data-bike-name');
                const bikeBrand = this.getAttribute('data-bike-brand');
                const bikePrice = parseInt(this.getAttribute('data-bike-price'));
                const bikeImage = this.getAttribute('data-bike-image');

                selectedBike = { 
                    id: bikeId, 
                    name: bikeName, 
                    brand: bikeBrand, 
                    price: bikePrice, 
                    image: bikeImage,
                    isRental: this.classList.contains('rent-btn')
                };

                if (selectedBike.isRental) {
                    // Añadir directamente al carrito si es una bicicleta de arriendo
                    cart.push(selectedBike);
                    updateCartCounter();
                    updateCartOffcanvas();
                    showToast('Bicicleta de arriendo añadida al carrito');
                } else {
                    // Mostrar el configurador para bicicletas personalizables
                    document.getElementById('bikesSection').style.display = 'none';
                    document.getElementById('configurador').style.display = 'block';
                    document.getElementById('bikePreview').src = bikeImage;
                }
            });
        });

        // Event listener para el botón de añadir al carrito (para bicicletas personalizadas)
        document.getElementById('addToCart').addEventListener('click', function() {
            if (selectedBike && !selectedBike.isRental) {
                const customizations = {};
                let totalPrice = selectedBike.price;
                document.querySelectorAll('.builder-select').forEach(select => {
                    const part = select.getAttribute('data-part');
                    const value = select.value;
                    if (value) {
                        customizations[part] = value;
                        const priceIncreaseMatch = select.options[select.selectedIndex].textContent.match(/\+\$(\d+(?:\.\d+)?)/);
                        if (priceIncreaseMatch) {
                            const priceIncrease = parseFloat(priceIncreaseMatch[1].replace(/\./g, '').replace(',', '.'));
                            totalPrice += priceIncrease;
                        }
                    }
                });

                const customizedBike = {
                    ...selectedBike,
                    customizations: customizations,
                    price: totalPrice
                };

                cart.push(customizedBike);
                updateCartCounter();
                updateCartOffcanvas();
                showToast('Bicicleta personalizada añadida al carrito');

                // Resetear la selección y volver a la vista de bicicletas
                selectedBike = null;
                document.getElementById('bikesSection').style.display = 'block';
                document.getElementById('configurador').style.display = 'none';
                document.querySelectorAll('.builder-select').forEach(select => select.value = '');
            }
        });

        // Inicializar el contador del carrito
        updateCartCounter();
    </script>
</body>
</html>